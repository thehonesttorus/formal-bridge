(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[333],{255:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>ea});var s=a(5155),i=a(2115),l=a(1075),n=a(6497),r=a(5626),c=a(2987),o=a(1989),d=a(7682),m=a(63),x=a(304),h=a(9368),p=a(4246);function u(e){let{onParsed:t,onError:a}=e,[n,r]=(0,i.useState)(!1),[c,o]=(0,i.useState)(!1),[d,m]=(0,i.useState)(null),x=(0,i.useCallback)(async e=>{o(!0),m(e.name);try{let a=await e.arrayBuffer(),s=p.LF(a,{type:"array"}),i=s.SheetNames[0],l=s.Sheets[i],n=p.Wp.sheet_to_json(l,{defval:null,raw:!1});if(0===n.length)throw Error("Spreadsheet appears to be empty");let r=Object.keys(n[0]);t({fileName:e.name,sheetName:i,columns:r,rows:n,rawFile:e})}catch(e){a(e instanceof Error?e.message:"Failed to parse spreadsheet")}finally{o(!1)}},[t,a]),h=(0,i.useCallback)(e=>{e.preventDefault(),r(!1);let t=e.dataTransfer.files[0];t&&(t.name.endsWith(".xlsx")||t.name.endsWith(".xls")||t.name.endsWith(".csv"))?x(t):a("Please upload an Excel file (.xlsx, .xls) or CSV")},[x,a]),u=(0,i.useCallback)(e=>{e.preventDefault(),r(!0)},[]),g=(0,i.useCallback)(e=>{e.preventDefault(),r(!1)},[]),f=(0,i.useCallback)(e=>{var t;let a=null==(t=e.target.files)?void 0:t[0];a&&x(a)},[x]);return(0,s.jsxs)(l.P.div,{onDrop:h,onDragOver:u,onDragLeave:g,className:"\n                relative border transition-all duration-300 cursor-pointer p-16 text-center\n                ".concat(n?"border-teal bg-teal/5":"border-slate-800/50 hover:border-slate-700","\n                ").concat(c?"pointer-events-none opacity-60":"","\n            "),children:[(0,s.jsx)("input",{type:"file",accept:".xlsx,.xls,.csv",onChange:f,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),c?(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-white font-light text-lg",children:["Parsing ",d,"..."]}),(0,s.jsx)("p",{className:"text-slate-500 font-light text-sm mt-2",children:"Extracting creditor data"})]}):d?(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-teal font-mono text-sm tracking-wide mb-2",children:"FILE LOADED"}),(0,s.jsx)("p",{className:"text-white font-light text-lg",children:d}),(0,s.jsx)("p",{className:"text-slate-500 font-light text-sm mt-2",children:"Drop another file to replace"})]}):(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-white font-light text-xl mb-2",children:n?"Release to upload":"Drop your creditor schedule here"}),(0,s.jsx)("p",{className:"text-slate-500 font-light text-sm",children:"or click to browse • .xlsx, .xls, .csv"}),(0,s.jsx)("p",{className:"text-slate-600 font-light text-xs mt-6",children:"Zero-retention • All processing happens locally"})]})]})}let g={name:{title:"Select the Creditor Name column",description:"Click on the column containing creditor or company names",hint:"Patterns: Creditor, Name, Company, Supplier"},amount:{title:"Select the Amount column",description:"Click on the column containing claim amounts",hint:"Patterns: Amount, Claim, Balance, Total"},classification:{title:"Select the Classification column (optional)",description:"Click on the column with tier or type, or skip to auto-detect",hint:"Patterns: Type, Class, Tier, Category"},confirm:{title:"Confirm mapping",description:"Review the column mapping before analysis",hint:""}};function f(e){let{data:t,onComplete:a,onCancel:l}=e,[n,r]=(0,i.useState)("name"),[o,d]=(0,i.useState)({}),m=e=>{"name"===n?(d({...o,nameColumn:e}),r("amount")):"amount"===n?(d({...o,amountColumn:e}),r("classification")):"classification"===n&&(d({...o,classificationColumn:e}),r("confirm"))},x=g[n],h=(e,t)=>{for(let a of e)if(t.some(e=>e.test(a)))return a;return null},p="name"===n?h(t.columns,[/name/i,/creditor/i,/company/i,/supplier/i,/payee/i,/vendor/i,/claimant/i]):"amount"===n?h(t.columns,[/amount/i,/amt/i,/claim/i,/balance/i,/total/i,/value/i,/owed/i,/outstanding/i,/due/i,/debt/i,/sum/i,/£/,/gbp/i]):"classification"===n?h(t.columns,[/type/i,/class/i,/tier/i,/category/i,/status/i,/priority/i,/rank/i]):null,u=["name","amount","classification","confirm"],f=u.indexOf(n);return(0,s.jsxs)("div",{className:"border border-slate-800/50",children:[(0,s.jsxs)("div",{className:"border-b border-slate-800/50 px-8 py-6",children:[(0,s.jsx)("div",{className:"flex items-center gap-8 mb-6",children:u.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("div",{className:"\n                                w-6 h-6 flex items-center justify-center text-xs font-mono\n                                ".concat(f>=t?"bg-teal text-midnight":"text-slate-600","\n                            "),children:t+1}),t<u.length-1&&(0,s.jsx)("div",{className:"w-8 h-px ".concat(f>t?"bg-teal/50":"bg-slate-800")})]},e))}),(0,s.jsx)("h3",{className:"text-xl font-light text-white",children:x.title}),(0,s.jsx)("p",{className:"text-sm text-slate-500 font-light mt-1",children:x.description})]}),(0,s.jsx)("div",{className:"p-8",children:"confirm"===n?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between py-3 border-b border-slate-800/50",children:[(0,s.jsx)("span",{className:"text-slate-500 font-light",children:"Creditor Name"}),(0,s.jsx)("span",{className:"font-mono text-teal",children:o.nameColumn})]}),(0,s.jsxs)("div",{className:"flex justify-between py-3 border-b border-slate-800/50",children:[(0,s.jsx)("span",{className:"text-slate-500 font-light",children:"Amount"}),(0,s.jsx)("span",{className:"font-mono text-teal",children:o.amountColumn})]}),(0,s.jsxs)("div",{className:"flex justify-between py-3 border-b border-slate-800/50",children:[(0,s.jsx)("span",{className:"text-slate-500 font-light",children:"Classification"}),(0,s.jsx)("span",{className:"font-mono text-slate-400",children:o.classificationColumn||"(Auto-detect)"})]})]}),(0,s.jsxs)("p",{className:"text-sm text-slate-600 font-light mt-8",children:[(0,s.jsx)("span",{className:"text-slate-400",children:t.rows.length})," creditor rows will be analyzed"]})]}):(0,s.jsxs)("div",{className:"space-y-4",children:[x.hint&&(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light",children:x.hint}),(0,s.jsx)("div",{className:"overflow-x-auto border border-slate-800/50",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsx)("tr",{className:"border-b border-slate-800/50",children:t.columns.map(e=>(0,s.jsx)("th",{onClick:()=>m(e),className:"\n                                                    px-4 py-3 text-left font-light cursor-pointer\n                                                    transition-colors hover:bg-teal/5 \n                                                    ".concat(e===p?"text-teal":"text-slate-300","\n                                                    ").concat(Object.values(o).includes(e)?"opacity-40":"","\n                                                "),children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[e,e===p&&(0,s.jsx)("span",{className:"text-xs text-teal/60 font-mono",children:"Suggested"})]})},e))})}),(0,s.jsx)("tbody",{children:t.rows.slice(0,5).map((e,a)=>(0,s.jsx)("tr",{className:"border-t border-slate-800/30",children:t.columns.map(t=>{var a;return(0,s.jsx)("td",{onClick:()=>m(t),className:"\n                                                        px-4 py-2 cursor-pointer hover:bg-slate-800/50 font-light\n                                                        ".concat(Object.values(o).includes(t)?"opacity-40 text-slate-600":"text-slate-500","\n                                                    "),children:String(null!=(a=e[t])?a:"")},t)})},a))})]})}),t.rows.length>5&&(0,s.jsxs)("p",{className:"text-xs text-slate-600 font-light",children:["Showing 5 of ",t.rows.length," rows"]})]})}),(0,s.jsxs)("div",{className:"border-t border-slate-800/50 px-8 py-4 flex justify-between",children:[(0,s.jsxs)("div",{className:"flex gap-4",children:["name"!==n&&(0,s.jsx)("button",{onClick:()=>{"amount"===n?r("name"):"classification"===n?r("amount"):"confirm"===n&&r("classification")},className:"text-slate-500 hover:text-white transition-colors text-sm font-light",children:"Back"}),(0,s.jsx)("button",{onClick:l,className:"text-slate-500 hover:text-white transition-colors text-sm font-light",children:"Cancel"})]}),(0,s.jsxs)("div",{className:"flex gap-4",children:["classification"===n&&(0,s.jsx)("button",{onClick:()=>{d({...o,classificationColumn:null}),r("confirm")},className:"px-6 py-2 border border-slate-700 text-slate-400 text-sm font-light hover:border-slate-600 transition-colors",children:"Skip (Auto-detect)"}),"confirm"===n&&(0,s.jsxs)("button",{onClick:()=>{if(o.nameColumn&&o.amountColumn){var e;a({nameColumn:o.nameColumn,amountColumn:o.amountColumn,classificationColumn:null!=(e=o.classificationColumn)?e:null})}},className:"inline-flex items-center gap-2 px-6 py-2 bg-teal text-midnight font-medium hover:bg-white transition-colors",children:["Analyze Classifications",(0,s.jsx)(c.A,{className:"w-4 h-4"})]})]})]})]})}var b=a(6132),j=a(2529),N=a(2056),y=a(1169),v=a(2108),w=a(4033),C=a(3327);function A(e){let{report:t,onProceed:a,onBack:r}=e,[c,o]=(0,i.useState)(t.blockingIssues>0?"blocking":t.warningIssues>0?"warnings":null),d=e=>{o(c===e?null:e)},m=t.amountIssues.filter(e=>"blocking"===e.warning.type),x=t.amountIssues.filter(e=>"warning"===e.warning.type);return(0,s.jsxs)("div",{className:"border border-slate-800/50 p-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("span",{className:"text-teal font-mono text-xs tracking-widest",children:"STATUTORY HEURISTICS"}),(0,s.jsx)("h2",{className:"text-2xl font-light text-white mt-2",children:"Data Integrity Report"}),(0,s.jsxs)("p",{className:"text-slate-400 font-light mt-2",children:[t.totalRows," creditors analyzed. Review any issues before proceeding."]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[(0,s.jsxs)("div",{className:"p-4 border ".concat(t.blockingIssues>0?"border-red-500/50 bg-red-500/5":"border-slate-800/50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[t.blockingIssues>0?(0,s.jsx)(b.A,{className:"w-4 h-4 text-red-400"}):(0,s.jsx)(j.A,{className:"w-4 h-4 text-teal"}),(0,s.jsx)("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Blocking"})]}),(0,s.jsx)("span",{className:"text-2xl font-light ".concat(t.blockingIssues>0?"text-red-400":"text-teal"),children:t.blockingIssues})]}),(0,s.jsxs)("div",{className:"p-4 border ".concat(t.warningIssues>0?"border-amber-500/50 bg-amber-500/5":"border-slate-800/50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[t.warningIssues>0?(0,s.jsx)(N.A,{className:"w-4 h-4 text-amber-400"}):(0,s.jsx)(j.A,{className:"w-4 h-4 text-teal"}),(0,s.jsx)("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Warnings"})]}),(0,s.jsx)("span",{className:"text-2xl font-light ".concat(t.warningIssues>0?"text-amber-400":"text-teal"),children:t.warningIssues})]}),(0,s.jsxs)("div",{className:"p-4 border ".concat(t.duplicateGroups.length>0?"border-blue-500/50 bg-blue-500/5":"border-slate-800/50"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,s.jsx)(y.A,{className:"w-4 h-4 text-blue-400"}),(0,s.jsx)("span",{className:"text-xs text-slate-500 uppercase tracking-wide",children:"Duplicates"})]}),(0,s.jsx)("span",{className:"text-2xl font-light ".concat(t.duplicateGroups.length>0?"text-blue-400":"text-slate-600"),children:t.duplicateGroups.length})]})]}),m.length>0&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("button",{onClick:()=>d("blocking"),className:"w-full flex items-center justify-between p-4 bg-red-500/10 border border-red-500/30 hover:bg-red-500/15 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(b.A,{className:"w-5 h-5 text-red-400"}),(0,s.jsxs)("span",{className:"text-red-400 font-medium",children:[m.length," Blocking Issue",m.length>1?"s":""," - Must Resolve"]})]}),"blocking"===c?(0,s.jsx)(v.A,{className:"w-5 h-5 text-red-400"}):(0,s.jsx)(w.A,{className:"w-5 h-5 text-red-400"})]}),(0,s.jsx)(n.N,{children:"blocking"===c&&(0,s.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-x border-b border-red-500/30",children:(0,s.jsx)("div",{className:"p-4 space-y-3",children:m.map((e,t)=>(0,s.jsx)(S,{issue:e},t))})})})]}),x.length>0&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("button",{onClick:()=>d("warnings"),className:"w-full flex items-center justify-between p-4 bg-amber-500/10 border border-amber-500/30 hover:bg-amber-500/15 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(N.A,{className:"w-5 h-5 text-amber-400"}),(0,s.jsxs)("span",{className:"text-amber-400 font-medium",children:[x.length," Warning",x.length>1?"s":""," - Review Recommended"]})]}),"warnings"===c?(0,s.jsx)(v.A,{className:"w-5 h-5 text-amber-400"}):(0,s.jsx)(w.A,{className:"w-5 h-5 text-amber-400"})]}),(0,s.jsx)(n.N,{children:"warnings"===c&&(0,s.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-x border-b border-amber-500/30",children:(0,s.jsx)("div",{className:"p-4 space-y-3",children:x.map((e,t)=>(0,s.jsx)(S,{issue:e},t))})})})]}),t.duplicateGroups.length>0&&(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("button",{onClick:()=>d("duplicates"),className:"w-full flex items-center justify-between p-4 bg-blue-500/10 border border-blue-500/30 hover:bg-blue-500/15 transition-colors",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)(y.A,{className:"w-5 h-5 text-blue-400"}),(0,s.jsxs)("span",{className:"text-blue-400 font-medium",children:[t.duplicateGroups.length," Potential Duplicate",t.duplicateGroups.length>1?"s":""]})]}),"duplicates"===c?(0,s.jsx)(v.A,{className:"w-5 h-5 text-blue-400"}):(0,s.jsx)(w.A,{className:"w-5 h-5 text-blue-400"})]}),(0,s.jsx)(n.N,{children:"duplicates"===c&&(0,s.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden border-x border-b border-blue-500/30",children:(0,s.jsx)("div",{className:"p-4 space-y-3",children:t.duplicateGroups.map((e,t)=>(0,s.jsx)(k,{group:e},t))})})})]}),0===t.blockingIssues&&0===t.warningIssues&&0===t.duplicateGroups.length&&(0,s.jsxs)("div",{className:"flex items-center gap-4 p-6 bg-teal/10 border border-teal/30 mb-6",children:[(0,s.jsx)(j.A,{className:"w-8 h-8 text-teal"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-teal font-medium",children:["All ",t.totalRows," creditors validated"]}),(0,s.jsx)("p",{className:"text-slate-400 text-sm font-light",children:"Data integrity checks passed. Ready for classification analysis."})]})]}),!t.canProceed&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 bg-red-500/10 border border-red-500/30 mb-6",children:[(0,s.jsx)(b.A,{className:"w-5 h-5 text-red-400 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-red-400 font-medium",children:"Cannot proceed with certification"}),(0,s.jsx)("p",{className:"text-slate-400 text-sm font-light mt-1",children:"Resolve all blocking issues above. Non-deterministic values (TBC, approx, etc.) cannot be mathematically verified."})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-8 pt-8 border-t border-slate-800/50",children:[(0,s.jsx)("button",{onClick:r,className:"px-8 py-4 border border-slate-700 text-slate-400 font-light hover:border-slate-500 transition-colors",children:"Back to Mapping"}),(0,s.jsxs)("button",{onClick:a,disabled:!t.canProceed,className:"flex-1 inline-flex items-center justify-center gap-3 px-8 py-4 bg-teal text-midnight font-medium hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)(j.A,{className:"w-4 h-4"}),t.canProceed?"Proceed to Classification Analysis":"Resolve Blocking Issues First"]})]})]})}function S(e){let{issue:t}=e;return(0,s.jsxs)("div",{className:"flex items-start gap-4 p-3 bg-slate-900/50",children:[(0,s.jsxs)("span",{className:"text-xs font-mono text-slate-600 w-12 flex-shrink-0",children:["Row ",t.rowNumber]}),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsx)("p",{className:"text-sm text-white font-light truncate",children:t.creditorName}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:t.warning.message}),t.warning.suggestion&&(0,s.jsxs)("p",{className:"text-xs text-teal mt-1 flex items-center gap-1",children:[(0,s.jsx)(C.A,{className:"w-3 h-3"}),t.warning.suggestion]})]}),(0,s.jsxs)("span",{className:"text-xs font-mono text-slate-600",children:["[",t.warning.code,"]"]})]})}function k(e){let{group:t}=e;return(0,s.jsxs)("div",{className:"p-3 bg-slate-900/50",children:[(0,s.jsx)("p",{className:"text-sm text-white font-light",children:t.message}),(0,s.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:t.creditors.map((e,t)=>(0,s.jsxs)("span",{className:"text-xs font-mono text-slate-500 bg-slate-800/50 px-2 py-1",children:["Row ",e.rowNumber]},t))})]})}function P(e){let{result:t,creditors:a,onAutoCorrect:l,onGenerateCertificate:n,isProcessing:r}=e,[o,d]=(0,i.useState)(new Set),m=t.warnings.length>0,x=t.summary.criticalCount>0;return(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"border p-8 ".concat(x?"border-red-500/30":m?"border-amber-500/30":"border-teal/30"),children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"font-mono text-xs tracking-widest ".concat(x?"text-red-400":m?"text-amber-400":"text-teal"),children:x?"LIABILITY EXPOSURE WARNING":m?"STATUTORY COMPLIANCE ISSUES":"AUDIT COMPLETE"}),(0,s.jsx)("h2",{className:"text-2xl font-light text-white mt-2",children:m?"".concat(t.warnings.length," statutory compliance breach").concat(t.warnings.length>1?"es":""," detected"):"All classifications verified"}),(0,s.jsxs)("p",{className:"text-slate-400 font-light mt-2",children:[a.length," creditors analyzed"]})]}),m&&(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Total at risk"}),(0,s.jsxs)("p",{className:"text-2xl font-light ".concat(x?"text-red-400":"text-amber-400"),children:["\xa3",t.totalAtRisk.toLocaleString()]})]})]}),m&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-8 mt-8 pt-8 border-t border-slate-800/50",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Potential Overpayment"}),(0,s.jsxs)("p",{className:"text-xl font-light mt-1 ".concat(t.crownGapTotal>0?"text-red-400":"text-slate-400"),children:["\xa3",t.crownGapTotal.toLocaleString()]}),(0,s.jsx)("p",{className:"text-xs text-red-400/70 mt-1",children:"Crown Preference Breach"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Employee Claims Misclassified"}),(0,s.jsxs)("p",{className:"text-xl font-light mt-1 ".concat(t.wagesGapTotal>0?"text-amber-400":"text-slate-400"),children:["\xa3",t.wagesGapTotal.toLocaleString()]}),(0,s.jsx)("p",{className:"text-xs text-amber-400/70 mt-1",children:"IA 1986 Sch.6 Breach"})]})]})]}),m&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm text-slate-400 font-medium mb-4",children:"Statutory Breaches Requiring Correction"}),(0,s.jsx)("div",{className:"space-y-2",children:t.warnings.map(e=>(0,s.jsx)(T,{warning:e,isExpanded:o.has(e.rowNumber),onToggle:()=>(e=>{let t=new Set(o);t.has(e)?t.delete(e):t.add(e),d(t)})(e.rowNumber)},e.rowNumber))})]}),(0,s.jsx)("div",{className:"flex gap-4 pt-8 border-t border-slate-800/50",children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:l,disabled:r,className:"flex-1 inline-flex items-center justify-center gap-3 px-8 py-4 bg-teal text-midnight font-medium hover:bg-white transition-colors disabled:opacity-50",children:["Auto-Correct & Generate Certificate",(0,s.jsx)(c.A,{className:"w-4 h-4"})]}),(0,s.jsx)("button",{onClick:n,disabled:r,className:"px-8 py-4 border border-slate-700 text-slate-400 font-light hover:border-slate-500 transition-colors disabled:opacity-50",children:"Keep Original"})]}):(0,s.jsxs)("button",{onClick:n,disabled:r,className:"flex-1 inline-flex items-center justify-center gap-3 px-8 py-4 bg-teal text-midnight font-medium hover:bg-white transition-colors disabled:opacity-50",children:[r?"Generating...":"Generate Audit Certificate",!r&&(0,s.jsx)(c.A,{className:"w-4 h-4"})]})})]})}function T(e){let{warning:t,isExpanded:a,onToggle:i}=e,r="critical"===t.severity;return(0,s.jsxs)("div",{className:"border ".concat(r?"border-red-500/20":"border-slate-800/50"),children:[(0,s.jsxs)("button",{onClick:i,className:"w-full px-6 py-4 flex items-center justify-between text-left hover:bg-white/5 transition-colors",children:[(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsxs)("span",{className:"text-white font-light",children:["Row ",t.rowNumber]}),(0,s.jsxs)("span",{className:"text-slate-400 font-light truncate",children:['"',t.creditorName,'"']}),(0,s.jsx)("span",{className:"text-xs font-mono ".concat(r?"text-red-400":"text-amber-400"),children:t.rule})]}),(0,s.jsxs)("p",{className:"text-sm text-slate-500 font-light mt-1",children:["\xa3",t.amount.toLocaleString()," • ",t.currentTier," → Tier ",t.suggestedTier]})]}),(0,s.jsx)(l.P.div,{animate:{rotate:180*!!a},transition:{duration:.2},children:(0,s.jsx)(w.A,{className:"w-4 h-4 text-slate-500"})})]}),(0,s.jsx)(n.N,{children:a&&(0,s.jsx)(l.P.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:.2},className:"overflow-hidden",children:(0,s.jsxs)("div",{className:"px-6 pb-4 space-y-3 border-t border-slate-800/50 pt-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Regulatory Breach"}),(0,s.jsx)("p",{className:"text-sm text-slate-300 font-light mt-1",children:t.regulatoryBreach})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Impact"}),(0,s.jsx)("p",{className:"text-sm font-light mt-1 ".concat(r?"text-red-400":"text-amber-400"),children:t.impactDescription})]})]})})})]})}var I=a(7978),D=a(6485);let E=new Date("2020-04-06"),R=new Date("2020-12-01");function L(e){let{onComplete:t,onBack:a,totalClaimsAnalyzed:n}=e,[r,o]=(0,i.useState)(""),[d,m]=(0,i.useState)(""),[x,h]=(0,i.useState)(""),[p,u]=(0,i.useState)(""),[g,f]=(0,i.useState)(!1),j=parseFloat(r.replace(/,/g,""))||0,N=parseFloat(x.replace(/,/g,""))||0,y=d?new Date(d):null,v=p?new Date(p):null,w=y&&y>=E,C=v&&v>=R,A=j<=N,S=j-N<1e4,k=r&&d&&x&&p;return(0,s.jsxs)("div",{className:"border border-slate-800/50 p-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("span",{className:"text-teal font-mono text-xs tracking-widest",children:"FINALIZE REALISATIONS"}),(0,s.jsx)("h2",{className:"text-2xl font-light text-white mt-2",children:"Complete the Statutory Waterfall"}),(0,s.jsxs)("p",{className:"text-slate-400 font-light mt-2",children:[n," creditors classified. Enter the realisation figures to calculate the Prescribed Part."]})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-400 font-light mb-3",children:[(0,s.jsx)(I.A,{className:"w-4 h-4"}),"Gross Floating Charge Realisations"]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500",children:"\xa3"}),(0,s.jsx)("input",{type:"text",value:r,onChange:e=>o(e.target.value),placeholder:"500,000",className:"w-full pl-10 pr-4 py-4 bg-transparent border border-slate-700 text-white text-lg placeholder-slate-600 focus:border-teal focus:outline-none transition-colors"})]}),(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light mt-2",children:"Total value of property subject to floating charge after deducting Fixed Charge payments"})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-400 font-light mb-3",children:[(0,s.jsx)(D.A,{className:"w-4 h-4"}),"Date of Floating Charge Being Settled"]}),(0,s.jsx)("input",{type:"date",value:d,onChange:e=>m(e.target.value),className:"w-full px-4 py-4 bg-transparent border border-slate-700 text-white focus:border-teal focus:outline-none transition-colors"}),y&&(0,s.jsxs)("p",{className:"text-xs font-light mt-2 ".concat(w?"text-teal":"text-amber-400"),children:["S.176A Cap: \xa3",(w?8e5:6e5).toLocaleString()," (",w?"Post-April 2020":"Pre-April 2020",")"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-400 font-light mb-3",children:[(0,s.jsx)(I.A,{className:"w-4 h-4"}),"Less: Tier 2 Liquidation Costs (SIP 9)"]}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-500",children:"\xa3"}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"50,000",className:"w-full pl-10 pr-4 py-4 bg-transparent border border-slate-700 text-white text-lg placeholder-slate-600 focus:border-teal focus:outline-none transition-colors"})]}),(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light mt-2",children:"IP fees, legal costs, and costs of realization (Category 1 & 2)"})]}),j>0&&(0,s.jsx)("div",{className:"p-4 bg-slate-900/50 border border-slate-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-sm text-slate-400 font-light",children:"Net Floating Charge Property (Calculated)"}),(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light mt-1",children:"Gross Realisations − Tier 2 Costs = Net Property"})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"text-2xl font-light ".concat(j-N>0?"text-teal":"text-amber-400"),children:["\xa3",(j-N).toLocaleString()]}),(0,s.jsxs)("p",{className:"text-xs text-slate-500 font-mono mt-1",children:["\xa3",j.toLocaleString()," − \xa3",N.toLocaleString()]})]})]})}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("label",{className:"flex items-center gap-2 text-sm text-slate-400 font-light mb-3",children:[(0,s.jsx)(D.A,{className:"w-4 h-4"}),"Insolvency Commencement Date"]}),(0,s.jsx)("input",{type:"date",value:p,onChange:e=>u(e.target.value),className:"w-full px-4 py-4 bg-transparent border border-slate-700 text-white focus:border-teal focus:outline-none transition-colors"}),v&&(0,s.jsxs)("p",{className:"text-xs font-light mt-2 ".concat(C?"text-teal":"text-amber-400"),children:["Crown Preference: ",C?"Applies (Post-1 Dec 2020)":"Does NOT apply (Pre-1 Dec 2020)"]})]}),A&&j>0&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"flex items-start gap-3 p-4 border border-amber-500/30 bg-amber-500/5",children:[(0,s.jsx)(b.A,{className:"w-5 h-5 text-amber-400 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-amber-400 font-medium text-sm",children:"Nil Distribution"}),(0,s.jsx)("p",{className:"text-slate-400 text-xs mt-1",children:"Costs exceed or equal Net Property. Distribution stops at Tier 2 (Expenses)."})]})]}),S&&!A&&(0,s.jsxs)("div",{className:"flex items-start gap-3 p-4 border border-slate-700",children:[(0,s.jsx)("input",{type:"checkbox",id:"deMinimis",checked:g,onChange:e=>f(e.target.checked),className:"mt-1 w-4 h-4 accent-teal"}),(0,s.jsxs)("label",{htmlFor:"deMinimis",className:"text-sm text-slate-400 font-light cursor-pointer",children:[(0,s.jsx)("span",{className:"text-white font-medium",children:"Apply De Minimis carve-out"}),(0,s.jsx)("span",{className:"block mt-1 text-xs",children:"Net Property is below \xa310,000. Under S.176A(3), you may waive the Prescribed Part if disproportionate."})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-8 pt-8 border-t border-slate-800/50",children:[(0,s.jsx)("button",{onClick:a,className:"px-8 py-4 border border-slate-700 text-slate-400 font-light hover:border-slate-500 transition-colors",children:"Back"}),(0,s.jsxs)("button",{onClick:()=>{k&&t({netFloatingChargeProperty:j,floatingChargeDate:d,totalCosts:N,insolvencyCommencementDate:p,applyDeMinimis:g})},disabled:!k,className:"flex-1 inline-flex items-center justify-center gap-3 px-8 py-4 bg-teal text-midnight font-medium hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:["Continue to Attestation",(0,s.jsx)(c.A,{className:"w-4 h-4"})]})]})]})}var F=a(7910);function _(e){let{ipName:t,onIpNameChange:a,onComplete:n,onBack:r,isProcessing:o}=e,[d,m]=(0,i.useState)(!1),[x,h]=(0,i.useState)(""),[p,u]=(0,i.useState)(!1),g=d&&t.trim().length>0&&(!p||x.trim().length>0);return(0,s.jsxs)("div",{className:"border border-slate-800/50 p-8",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("span",{className:"text-teal font-mono text-xs tracking-widest",children:"SEAL AUDIT CERTIFICATE"}),(0,s.jsx)("h2",{className:"text-2xl font-light text-white mt-2",children:"Confirm Data Accuracy"}),(0,s.jsx)("p",{className:"text-slate-400 font-light mt-2",children:"Before sealing the Audit Certificate, please confirm the accuracy of the inputs provided."})]}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm text-slate-400 font-light mb-3",children:"Appointed Insolvency Practitioner"}),(0,s.jsx)("input",{type:"text",value:t,onChange:e=>a(e.target.value),placeholder:"John Smith",className:"w-full px-4 py-4 bg-transparent border border-slate-700 text-white placeholder-slate-600 focus:border-teal focus:outline-none transition-colors"})]}),(0,s.jsxs)("div",{className:"flex items-start gap-3",children:[(0,s.jsx)("input",{type:"checkbox",id:"onBehalf",checked:p,onChange:e=>u(e.target.checked),className:"mt-1 w-4 h-4 accent-teal"}),(0,s.jsx)("label",{htmlFor:"onBehalf",className:"text-sm text-slate-400 font-light cursor-pointer",children:"I am completing this on behalf of the IP"})]}),p&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},children:[(0,s.jsx)("label",{className:"block text-sm text-slate-400 font-light mb-3",children:"Your Name"}),(0,s.jsx)("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Your name",className:"w-full px-4 py-4 bg-transparent border border-slate-700 text-white placeholder-slate-600 focus:border-teal focus:outline-none transition-colors"})]}),(0,s.jsx)("div",{className:"p-6 border border-slate-700 bg-slate-900/50",children:(0,s.jsxs)("div",{className:"flex items-start gap-4",children:[(0,s.jsx)("input",{type:"checkbox",id:"attestation",checked:d,onChange:e=>m(e.target.checked),className:"mt-1 w-5 h-5 accent-teal flex-shrink-0"}),(0,s.jsx)("label",{htmlFor:"attestation",className:"text-sm text-slate-300 font-light cursor-pointer leading-relaxed",children:"I, the undersigned, attest that the inputs provided—including creditor classifications, asset realisations, and expense figures—accurately reflect the records of the Estate. I acknowledge that Formal Bridge verifies the mathematical application of the Insolvency Act 1986 based on these attested inputs."})]})}),(0,s.jsxs)("div",{className:"flex items-start gap-3 text-slate-500 text-xs",children:[(0,s.jsx)(N.A,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),(0,s.jsxs)("p",{children:['The Audit Certificate will state: "Attested by ',p&&x?x:t||"[Name]",p&&x?" on behalf of ".concat(t||"[IP Name]"):"",", ",p?"Administrator":"Joint Liquidator",'."']})]})]}),(0,s.jsxs)("div",{className:"flex gap-4 mt-8 pt-8 border-t border-slate-800/50",children:[(0,s.jsx)("button",{onClick:r,className:"px-8 py-4 border border-slate-700 text-slate-400 font-light hover:border-slate-500 transition-colors",children:"Back"}),(0,s.jsxs)("button",{onClick:()=>n(p&&x?x:void 0),disabled:!g||o,className:"flex-1 inline-flex items-center justify-center gap-3 px-8 py-4 bg-teal text-midnight font-medium hover:bg-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[(0,s.jsx)(F.A,{className:"w-4 h-4"}),o?"Sealing Certificate...":"Seal Audit Certificate",!o&&(0,s.jsx)(c.A,{className:"w-4 h-4"})]})]})]})}function O(e){return new Intl.NumberFormat("en-GB",{style:"currency",currency:"GBP",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function B(e){let{netFloatingChargeProperty:t,totalCosts:a,floatingChargeDate:i,prescribedPart:n,capApplied:r,tiersBreakdown:c,isDeMinimisApplied:o,isNilDistribution:d}=e,m=t-a,x=Math.min(m,1e4),h=.5*x,p=Math.max(0,m-1e4),u=.2*p,g=h+u,f=g>r,N=[{cite:"IR 14.3",text:"Gross Floating Charge Realisations: ".concat(O(t))},{cite:"SIP 9",text:"Less: Tier 2 Liquidation Costs: ".concat(O(a))},{cite:"IA 1986",text:"Net Property Available for Distribution: ".concat(O(m))},{cite:"s.176A(2)(a)",text:"First Tranche Applied: 50% of ".concat(O(x)," = ").concat(O(h))},{cite:"s.176A(2)(b)",text:"Second Tranche Applied: 20% of ".concat(O(p)," = ").concat(O(u))},f?{cite:"s.176A(5)",text:"Statutory Cap Applied: ".concat(O(r)," (").concat(8e5===r?"Post-April 2020":"Pre-April 2020",")")}:{cite:"s.176A(5)",text:"Cap Compliance: Total ".concat(O(g)," does not exceed ").concat(O(r))},o?{cite:"s.176A(3)",verified:!0,text:"De Minimis Exception Applied: Prescribed Part waived"}:{cite:"VERIFIED",verified:!0,text:"Prescribed Part Calculation: ".concat(O(n))}];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"border p-6 ".concat(d?"border-amber-500/30":"border-teal/30"),children:[(0,s.jsxs)("div",{className:"flex items-center gap-3 mb-4",children:[d?(0,s.jsx)(b.A,{className:"w-5 h-5 text-amber-400"}):(0,s.jsx)(j.A,{className:"w-5 h-5 text-teal"}),(0,s.jsx)("span",{className:"font-mono text-xs tracking-widest ".concat(d?"text-amber-400":"text-teal"),children:d?"NIL DISTRIBUTION":"CALCULATION COMPLETE"})]}),!d&&(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Prescribed Part (S.176A)"}),(0,s.jsx)("p",{className:"text-3xl font-light text-teal mt-1",children:o?"Waived":O(n)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-slate-500 font-light",children:"Applicable Cap"}),(0,s.jsx)("p",{className:"text-xl font-light text-white mt-1",children:O(r)}),(0,s.jsx)("p",{className:"text-xs text-slate-600 mt-1",children:8e5===r?"Post-April 2020":"Pre-April 2020"})]})]})]}),(0,s.jsxs)("div",{className:"border border-slate-800/50 p-6",children:[(0,s.jsx)("h3",{className:"text-sm text-slate-400 font-medium mb-4",children:"Creditor Tier Summary"}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-slate-800/30",children:[(0,s.jsx)("span",{className:"text-slate-400 font-light",children:"Tier 3a (Preferential - Employees)"}),(0,s.jsx)("span",{className:"text-white font-medium",children:O(c.tier3a)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-slate-800/30",children:[(0,s.jsx)("span",{className:"text-slate-400 font-light",children:"Tier 3b (Secondary Preferential - Crown)"}),(0,s.jsx)("span",{className:"text-white font-medium",children:O(c.tier3b)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2 border-b border-slate-800/30",children:[(0,s.jsx)("span",{className:"text-slate-400 font-light",children:"Tier 4 (Prescribed Part)"}),(0,s.jsx)("span",{className:"text-teal font-medium",children:o?"Waived":O(n)})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center py-2",children:[(0,s.jsx)("span",{className:"text-slate-400 font-light",children:"Tier 6 (Unsecured)"}),(0,s.jsx)("span",{className:"text-white font-medium",children:O(c.tier6)})]})]})]}),(0,s.jsxs)("div",{className:"bg-slate-900/50 border border-slate-800/50 p-6",children:[(0,s.jsx)("h3",{className:"text-sm text-slate-400 font-medium mb-4",children:"Statutory Computation Trace"}),(0,s.jsx)("div",{className:"space-y-2 font-mono text-xs",children:N.map((e,t)=>(0,s.jsxs)(l.P.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:.1*t},className:"flex gap-2 ".concat(e.verified?"text-teal":"text-slate-400"),children:[(0,s.jsxs)("span",{className:"".concat(e.verified?"text-teal":"text-slate-600"),children:["[",e.cite,"]"]}),(0,s.jsx)("span",{children:e.text})]},t))})]})]})}let U={hmrc:/\b(hmrc|h\.m\.r\.c\.?|hm\s*revenue|inland\s*revenue)\b/i,vat:/\b(vat|value\s*added\s*tax)\b/i,paye:/\b(paye|pay\s*as\s*you\s*earn)\b/i,cis:/\b(cis|construction\s*industry\s*scheme)\b/i,nationalInsurance:/\b(nic|national\s*insurance|ni\s*contributions?)\b/i},M={wages:/\b(wages?|salary|salaries|arrears\s*of\s*pay|employee\s*wages?)\b/i,holidayPay:/\b(holiday\s*pay|annual\s*leave|accrued\s*leave)\b/i,redundancy:/\b(redundancy|notice\s*pay|lieu\s*of\s*notice)\b/i,pension:/\b(pension\s*contributions?|occupational\s*pension|auto-?enrolment)\b/i},z=/\b(ltd|limited|plc|inc|incorporated|llp|services|solutions|consulting|consultants|group|holdings|agency|associates|partners)\b/i,G=[/holiday\s*inn/i,/wageworks/i];function V(e){return!!(z.test(e)||G.some(t=>t.test(e)))}function Y(e){let t=[],a=0,s=0;for(let n of e){var i,l;let e=function(e){let t=e.toLowerCase().trim();return["1","2","3a","3b","4","5","6","7","8"].includes(t)?t:t.includes("unsecured")||t.includes("ordinary")?"6":t.includes("preferential")&&!t.includes("secondary")?"3a":t.includes("secondary")||t.includes("crown")?"3b":t.includes("secured")||t.includes("fixed")?"1":t.includes("floating")?"5":null}(n.currentTier);if(function(e){return!V(e)&&Object.values(U).some(t=>t.test(e))}(n.name)&&"6"===e){let e=(i=n.name,U.vat.test(i)?"VAT":U.paye.test(i)?"PAYE":U.cis.test(i)?"CIS":U.nationalInsurance.test(i)?"National Insurance":U.hmrc.test(i)?"HMRC":"Crown");t.push({rowNumber:n.rowNumber,creditorName:n.name,amount:n.amount,currentTier:n.currentTier,suggestedTier:"3b",severity:"critical",rule:"[FA2020 s.98] Crown Preference Breach",regulatoryBreach:"STATUTORY BREACH: ".concat(e," identified in Tier 6 (Unsecured). Finance Act 2020 designates this as Tier 3b (Secondary Preferential)."),impactDescription:"You are about to overpay Unsecured Creditors by \xa3".concat(n.amount.toLocaleString(),". This creates personal regulatory liability for the distributing Practitioner.")}),a+=n.amount}!V(l=n.name)&&(M.wages.test(l)||M.holidayPay.test(l)||M.redundancy.test(l)||M.pension.test(l))&&("6"===e&&(t.push({rowNumber:n.rowNumber,creditorName:n.name,amount:n.amount,currentTier:n.currentTier,suggestedTier:"3a",severity:"critical",rule:"[IA1986 Sch.6] Preferential Creditor Breach",regulatoryBreach:"STATUTORY BREACH: Employee claim identified in Tier 6 (Unsecured). Insolvency Act 1986 Schedule 6 designates this as Tier 3a (Preferential).",impactDescription:"\xa3".concat(n.amount.toLocaleString()," should rank ahead of Unsecured creditors. Incorrect distribution creates personal liability.")}),s+=n.amount),n.amount>800&&M.wages.test(n.name)&&"3a"!==e&&(t.find(e=>e.rowNumber===n.rowNumber)||t.push({rowNumber:n.rowNumber,creditorName:n.name,amount:n.amount,currentTier:n.currentTier,suggestedTier:"3a",severity:"warning",rule:"[IA1986 Sch.6 Para.9(c)] Wages Threshold",regulatoryBreach:"Amount exceeds \xa3800 preferential cap per employee under Para 9(c) Schedule 6.",impactDescription:"Excess above \xa3800 may need to be split between Preferential (3a) and Unsecured (6)."})))}t.sort((e,t)=>{let a={critical:0,warning:1,info:2};return a[e.severity]-a[t.severity]});let n={criticalCount:t.filter(e=>"critical"===e.severity).length,warningCount:t.filter(e=>"warning"===e.severity).length,infoCount:t.filter(e=>"info"===e.severity).length};return{warnings:t,totalAtRisk:a+s,crownGapTotal:a,wagesGapTotal:s,summary:n}}let W=[/\btbc\b/i,/\bapprox\.?\b/i,/\bestimate[ds]?\b/i,/\bsee\s+note/i,/\bunknown\b/i,/\bpending\b/i,/\btba\b/i,/\?/],J=/[£$€¥]/g,q=/,/g,Z=/^\s*\(([^)]+)\)\s*$/;var H=a(316),X=a.n(H);async function Q(e){return new Promise((t,a)=>{let s=new FileReader;s.onload=e=>{try{var s;let a=null==(s=e.target)?void 0:s.result,i=X().lib.WordArray.create(a),l=X().SHA256(i).toString(X().enc.Hex);t(l)}catch(e){a(e)}},s.onerror=()=>a(Error("Failed to read file")),s.readAsArrayBuffer(e)})}let K=new Date(2020,3,6);var $=a(2619),ee=a.n($);let et=[{id:"upload",label:"Upload Schedule"},{id:"mapping",label:"Confirm Columns"},{id:"integrity",label:"Data Check"},{id:"analysis",label:"Review"},{id:"finalization",label:"Finalize Realisations"},{id:"attestation",label:"Seal Audit Certificate"},{id:"certificate",label:"Complete"}];function ea(){let e=(0,d.useRouter)(),t=(0,o.U)(),[a,p]=(0,i.useState)(null),[g,b]=(0,i.useState)("upload"),[j,N]=(0,i.useState)(null),[y,v]=(0,i.useState)([]),[w,C]=(0,i.useState)(null),[S,k]=(0,i.useState)(null),[T,I]=(0,i.useState)(""),[D,E]=(0,i.useState)(null),[R,F]=(0,i.useState)(!1),[O,U]=(0,i.useState)(null),[M,z]=(0,i.useState)(""),[G,V]=(0,i.useState)(null),[H,X]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{let{data:{user:a}}=await t.auth.getUser();a?p(a):e.push("/login")})()},[t,e]);let[$,ea]=(0,i.useState)(null);(0,i.useEffect)(()=>{!async function(){try{let e=await fetch("/api/usage");if(e.ok){let t=await e.json();ea(t)}}catch(e){console.error("Failed to fetch usage:",e)}}()},[]);let es=et.findIndex(e=>e.id===g),ei=(0,i.useCallback)(async e=>{N(e),E(null),I(await Q(e.rawFile)),b("mapping")},[]),el=(0,i.useCallback)(e=>{if(!j)return;let t=j.rows.map((t,a)=>{var s,i;let l=String(null!=(s=t[e.nameColumn])?s:""),n=t[e.amountColumn],r=function(e){let t=String(null!=e?e:"").trim(),a=[];if(!t||""===t)return{value:0,original:t,warnings:[{type:"blocking",code:"EMPTY_AMOUNT",message:"Amount field is empty",suggestion:"Enter a numeric value"}],isValid:!1,requiresReview:!0};if("number"==typeof e&&!isNaN(e))return{value:e,original:t,warnings:[],isValid:!0,requiresReview:!1};for(let e of W)if(e.test(t))return{value:0,original:t,warnings:[{type:"blocking",code:"NON_DETERMINISTIC",message:'Non-deterministic value: "'.concat(t,'"'),suggestion:"Replace with exact numeric amount before certification"}],isValid:!1,requiresReview:!0};let s=t;J.test(s)&&(a.push({type:"info",code:"CURRENCY_STRIPPED",message:"Currency symbol removed"}),s=s.replace(J,""));let i=s.match(Z);i&&(a.push({type:"warning",code:"CONTRA_DETECTED",message:"Negative/contra amount detected",suggestion:"Verify this represents a contra entry or credit balance"}),s="-"+i[1]),q.test(s)&&(s=s.replace(q,""));let l=parseFloat(s=s.replace(/[^\d.\-]/g,""));return isNaN(l)?{value:0,original:t,warnings:[{type:"blocking",code:"PARSE_FAILED",message:'Could not parse "'.concat(t,'" as a number'),suggestion:"Enter a valid numeric amount"}],isValid:!1,requiresReview:!0}:(0===l&&a.push({type:"warning",code:"ZERO_AMOUNT",message:"Amount is zero",suggestion:"Verify this is intentional (e.g., fully paid claim)"}),l<0&&a.push({type:"warning",code:"NEGATIVE_AMOUNT",message:"Negative amount - may require netting before distribution",suggestion:"Review contra entries with IP before proceeding"}),{value:l,original:t,warnings:a,isValid:!0,requiresReview:a.some(e=>"warning"===e.type)})}(n),c="6";return e.classificationColumn&&(c=String(null!=(i=t[e.classificationColumn])?i:"6")),{rowNumber:a+2,name:l,rawAmount:String(null!=n?n:""),sanitizedAmount:r,currentTier:c}}).filter(e=>""!==e.name.trim());k(function(e){let t=[],a=0,s=0,i=0;for(let l of e)for(let e of l.sanitizedAmount.warnings)"blocking"===e.type&&a++,"warning"===e.type&&s++,"info"===e.type&&i++,"info"!==e.type&&t.push({rowNumber:l.rowNumber,creditorName:l.name,warning:e});let l=function(e){let t=[],a=e=>e.toLowerCase().replace(/[^a-z0-9]/g,""),s=new Map;for(let t of e){let e=a(t.name);s.has(e)||s.set(e,[]),s.get(e).push(t)}for(let[,e]of s)if(e.length>1){let a=1===new Set(e.map(e=>e.amount)).size;t.push({type:a?"both":"exact_name",creditors:e,severity:a?"warning":"info",message:a?"Potential duplicate: ".concat(e.length,' entries for "').concat(e[0].name,'" with identical amounts (\xa3').concat(e[0].amount.toLocaleString(),")"):'Multiple entries for "'.concat(e[0].name,'" with different amounts')})}return t}(e.map(e=>({rowNumber:e.rowNumber,name:e.name,amount:e.sanitizedAmount.value}))),n=[];return a>0&&n.push("".concat(a," value").concat(a>1?"s":""," require correction before certification")),s>0&&n.push("".concat(s," item").concat(s>1?"s":""," flagged for review")),l.length>0&&n.push("".concat(l.length," potential duplicate").concat(l.length>1?"s":""," detected")),0===n.length&&n.push("All values validated successfully"),{totalRows:e.length,validRows:e.filter(e=>e.sanitizedAmount.isValid).length,blockingIssues:a,warningIssues:s,infoIssues:i,duplicateGroups:l,amountIssues:t,canProceed:0===a,summary:n}}(t)),v(t.filter(e=>e.sanitizedAmount.isValid&&e.sanitizedAmount.value>0).map(e=>({rowNumber:e.rowNumber,name:e.name,amount:e.sanitizedAmount.value,currentTier:e.currentTier}))),b("integrity")},[j]),en=(0,i.useCallback)(()=>{C(Y(y)),b("analysis")},[y]),er=(0,i.useCallback)(()=>{b("mapping")},[]),ec=(0,i.useCallback)(()=>{if(!w||!y.length)return;let e=function(e,t){let a=new Map(t.map(e=>[e.rowNumber,e.suggestedTier]));return e.map(e=>{let t=a.get(e.rowNumber);return t?{...e,currentTier:t}:e})}(y,w.warnings);v(e),C(Y(e))},[w,y]),eo=(0,i.useCallback)(()=>{b("finalization")},[]),ed=(0,i.useCallback)(e=>{U(e);let t=e.netFloatingChargeProperty-e.totalCosts,a=t<=0,s=new Date(e.floatingChargeDate)>=new Date("2020-04-06")?8e5:6e5,i=0;a||e.applyDeMinimis||(i=function(e,t){let a=[],s=t<K?6e5:8e5;if(e<=0)return a.push("Net Property \xa3".concat(e.toLocaleString()," ≤ \xa30. No prescribed part.")),{netProperty:e,floatingChargeDate:t,firstTranche:0,secondTranche:0,uncappedTotal:0,capApplied:s,finalAmount:0,wasCapped:!1,legislativeBasis:"Insolvency Act 1986 s.176A",verificationSteps:a};a.push("Net Property: \xa3".concat(e.toLocaleString())),a.push("Net Property \xa3".concat(e.toLocaleString()," > \xa310,000 Threshold."));let i=Math.min(e,1e4),l=Math.floor(.5*i);a.push("First Tranche: 50% of \xa3".concat(i.toLocaleString()," = \xa3").concat(l.toLocaleString()));let n=Math.max(0,e-1e4),r=Math.floor(.2*n);n>0&&a.push("Excess: \xa3".concat(n.toLocaleString(),". Second Tranche: 20% of Excess = \xa3").concat(r.toLocaleString()));let c=l+r;a.push("Total Calculated: \xa3".concat(c.toLocaleString()));let o=c>s,d=Math.min(c,s);return o?a.push("Cap Check: \xa3".concat(c.toLocaleString()," > \xa3").concat(s.toLocaleString(),". Cap Applied.")):a.push("Cap Check: \xa3".concat(c.toLocaleString()," < \xa3").concat(s.toLocaleString(),". No Cap Applied.")),a.push("[VERIFIED] Theorem prescribedPart_le_cap holds."),{netProperty:e,floatingChargeDate:t,firstTranche:l,secondTranche:r,uncappedTotal:c,capApplied:s,finalAmount:d,wasCapped:o,legislativeBasis:t>=K?"Insolvency Act 1986 s.176A (as amended SI 2020/211)":"Insolvency Act 1986 s.176A",verificationSteps:a}}(t,new Date(e.floatingChargeDate)).finalAmount),V({prescribedPart:i,cap:s,isDeMinimisApplied:e.applyDeMinimis,isNilDistribution:a}),b("attestation")},[]),em=(0,i.useCallback)(async e=>{if(O&&G&&a){F(!0),E(null);try{let t=function(){let e="ABCDEFGHJKLMNPQRSTUVWXYZ23456789",t="";for(let a=0;a<10;a++)t+=e.charAt(Math.floor(Math.random()*e.length));return"FB-".concat(t.slice(0,6),"-").concat(t.slice(6))}(),s=y.filter(e=>"3a"===e.currentTier).reduce((e,t)=>e+t.amount,0),i=y.filter(e=>"3b"===e.currentTier).reduce((e,t)=>e+t.amount,0),l=y.filter(e=>"6"===e.currentTier).reduce((e,t)=>e+t.amount,0),n={user_id:a.id,user_email:a.email||"",case_reference:void 0,ip_name:M,attested_by:e,input_file_hash:T,creditor_count:y.length,net_floating_charge_property:O.netFloatingChargeProperty,floating_charge_date:O.floatingChargeDate,total_costs:O.totalCosts,insolvency_commencement_date:O.insolvencyCommencementDate,prescribed_part:G.prescribedPart,cap_applied:G.cap,is_de_minimis_applied:G.isDeMinimisApplied,is_nil_distribution:G.isNilDistribution,tier_3a_total:s,tier_3b_total:i,tier_6_total:l,verification_code:t,kernel_version:"InsolvencyLib v1.0.0-lean4"},r=await fetch("/api/certificates",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!r.ok){if(402===r.status){let e=await r.json();E("Free certificate limit reached (".concat(e.usedCount,"/").concat(e.limit,"). Upgrade to continue generating certificates.")),F(!1);return}console.warn("Failed to save certificate metadata")}let c=await fetch("".concat("https://insolvencylib-api.fly.dev","/api/prescribedpart/certificate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({netProperty:O.netFloatingChargeProperty-O.totalCosts,floatingChargeDate:O.floatingChargeDate,ipName:M,inputHash:T,verificationCode:t})});if(!c.ok)throw Error("Failed to generate certificate");let o=await c.blob(),d=URL.createObjectURL(o),m=document.createElement("a");m.href=d,m.download="FormalBridge_AuditCertificate_".concat(t,".pdf"),document.body.appendChild(m),m.click(),document.body.removeChild(m),URL.revokeObjectURL(d),b("certificate")}catch(e){E(e instanceof Error?e.message:"Certificate generation failed")}finally{F(!1)}}},[O,G,M,T,y,a]);(0,i.useCallback)(async()=>{if(y.length){F(!0);try{let e=y.reduce((e,t)=>e+t.amount,0),t=await fetch("".concat("https://insolvencylib-api.fly.dev","/api/prescribedpart/certificate"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({netProperty:e,floatingChargeDate:new Date().toISOString()})});if(!t.ok)throw Error("Failed to generate certificate");let a=await t.blob(),s=URL.createObjectURL(a),i=document.createElement("a");i.href=s,i.download="FormalBridge_Certificate_".concat(Date.now(),".pdf"),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s),b("certificate")}catch(e){E(e instanceof Error?e.message:"Certificate generation failed")}finally{F(!1)}}},[y]);let ex=()=>{b("upload"),N(null),v([]),C(null),I(""),E(null),U(null),z(""),V(null)};return(0,s.jsxs)("main",{className:"bg-midnight min-h-screen selection:bg-teal selection:text-midnight relative",children:[(0,s.jsx)("div",{className:"fixed inset-0 z-0",children:(0,s.jsx)(h.default,{})}),(0,s.jsxs)("div",{className:"relative z-10 text-white",children:[(0,s.jsx)(m.default,{}),(0,s.jsx)("section",{className:"pt-40 pb-20 px-6",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"mb-16",children:[(0,s.jsxs)(ee(),{href:"/portal",className:"inline-flex items-center gap-2 text-slate-500 hover:text-white transition-colors mb-10 text-sm font-light",children:[(0,s.jsx)(r.A,{className:"w-4 h-4"}),"Back to Portal"]}),(0,s.jsx)("span",{className:"text-teal font-mono tracking-widest text-sm font-medium block",children:"S.176A STATUTORY AUDIT"}),(0,s.jsxs)("h1",{className:"text-4xl md:text-5xl font-light text-white mt-4 leading-tight",children:["Statutory Distribution",(0,s.jsx)("span",{className:"font-medium",children:" Audit"})]}),(0,s.jsx)("p",{className:"text-lg text-slate-400 font-light mt-4 max-w-xl",children:"Upload your creditor list. We verify classifications, calculate the Prescribed Part, and generate your Audit Certificate."}),(0,s.jsx)("div",{className:"mt-4 inline-flex items-center gap-2 px-4 py-2 bg-amber-900/20 border border-amber-700/30 rounded",children:(0,s.jsx)("span",{className:"text-amber-400 text-sm font-medium",children:"\xa350.00 | Category 1 Estate Expense (SIP 9 Compliant)"})})]}),(0,s.jsx)(l.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.1},className:"mb-12",children:(0,s.jsx)("div",{className:"flex items-center",children:et.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center flex-1 last:flex-initial",children:[(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)("div",{className:"\n                                                w-8 h-8 rounded-full flex items-center justify-center text-xs font-mono\n                                                ".concat(es>=t?"bg-teal text-midnight":"border border-slate-700 text-slate-600","\n                                            "),children:t+1}),(0,s.jsx)("span",{className:"mt-2 text-xs font-light ".concat(es>=t?"text-slate-300":"text-slate-600"),children:e.label})]}),t<et.length-1&&(0,s.jsx)("div",{className:"flex-1 h-px mx-4 ".concat(es>t?"bg-teal/50":"bg-slate-800")})]},e.id))})}),(0,s.jsx)(n.N,{children:D&&(0,s.jsx)(l.P.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"mb-8 p-4 border border-red-500/30 text-red-400 text-sm font-light",children:D})}),(0,s.jsxs)(n.N,{mode:"wait",children:["upload"===g&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:[$&&(0,s.jsx)("div",{className:"mb-8 p-4 border ".concat($.hasReachedLimit?"border-red-500/30 bg-red-500/5":1===$.remainingFree?"border-amber-500/30 bg-amber-500/5":"border-slate-800/50"),children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("div",{children:$.hasReachedLimit?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"text-red-400 font-medium",children:"Free certificate limit reached"}),(0,s.jsx)("p",{className:"text-xs text-slate-500 mt-1",children:"You have used all 3 free certificates. Upgrade to continue."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("span",{className:"text-slate-400 font-light",children:[(0,s.jsx)("span",{className:"text-teal font-medium",children:$.remainingFree})," ","of 3 free certificates remaining"]}),1===$.remainingFree&&(0,s.jsx)("p",{className:"text-xs text-amber-400 mt-1",children:"This is your last free certificate"})]})}),(0,s.jsx)("div",{className:"flex gap-1",children:[1,2,3].map(e=>(0,s.jsx)("div",{className:"w-3 h-3 rounded-full ".concat(e<=$.usedCount?"bg-teal":"border border-slate-700")},e))})]})}),(null==$?void 0:$.hasReachedLimit)?(0,s.jsxs)("div",{className:"text-center py-12",children:[(0,s.jsx)("p",{className:"text-slate-400 mb-4",children:"Upgrade to generate unlimited certificates"}),(0,s.jsx)(ee(),{href:"/portal/early-access",className:"inline-flex items-center gap-2 px-6 py-3 bg-teal text-midnight font-medium hover:bg-white transition-colors",children:"Join Early Access Waitlist"})]}):(0,s.jsx)(u,{onParsed:ei,onError:E}),(0,s.jsxs)("div",{className:"mt-12 grid md:grid-cols-3 gap-8 border-t border-slate-800/50 pt-12",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm text-slate-400 font-medium mb-2",children:"Crown Preference"}),(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light leading-relaxed",children:"Detects HMRC, VAT, PAYE, NIC claims incorrectly listed as unsecured."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm text-slate-400 font-medium mb-2",children:"Wages Threshold"}),(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light leading-relaxed",children:"Verifies \xa3800 preferential cap and correct tier classification."})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-sm text-slate-400 font-medium mb-2",children:"Zero Retention"}),(0,s.jsx)("p",{className:"text-xs text-slate-600 font-light leading-relaxed",children:"All processing happens locally. Data purged immediately."})]})]})]},"upload"),"mapping"===g&&j&&(0,s.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:(0,s.jsx)(f,{data:j,onComplete:el,onCancel:ex})},"mapping"),"integrity"===g&&S&&(0,s.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:(0,s.jsx)(A,{report:S,onProceed:en,onBack:er})},"integrity"),"analysis"===g&&w&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:[(0,s.jsx)(P,{result:w,creditors:y,onAutoCorrect:ec,onGenerateCertificate:eo,isProcessing:R}),T&&(0,s.jsx)("div",{className:"mt-8 pt-6 border-t border-slate-800/50",children:(0,s.jsxs)("p",{className:"text-xs text-slate-600 font-light",children:[(0,s.jsx)("span",{className:"text-slate-500",children:"Input Hash:"})," ",(0,s.jsxs)("span",{className:"font-mono",children:[T.slice(0,24),"...",T.slice(-8)]})]})})]},"analysis"),"finalization"===g&&(0,s.jsx)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},children:(0,s.jsx)(L,{onComplete:ed,onBack:()=>b("analysis"),totalClaimsAnalyzed:y.length})},"finalization"),"attestation"===g&&O&&G&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.4},className:"space-y-8",children:[(0,s.jsx)(B,{netFloatingChargeProperty:O.netFloatingChargeProperty,totalCosts:O.totalCosts,floatingChargeDate:O.floatingChargeDate,prescribedPart:G.prescribedPart,capApplied:G.cap,tiersBreakdown:{tier3a:y.filter(e=>"3a"===e.currentTier).reduce((e,t)=>e+t.amount,0),tier3b:y.filter(e=>"3b"===e.currentTier).reduce((e,t)=>e+t.amount,0),tier6:y.filter(e=>"6"===e.currentTier).reduce((e,t)=>e+t.amount,0)},isDeMinimisApplied:G.isDeMinimisApplied,isNilDistribution:G.isNilDistribution}),(0,s.jsx)(_,{ipName:M,onIpNameChange:z,onComplete:em,onBack:()=>b("finalization"),isProcessing:R})]},"attestation"),"certificate"===g&&(0,s.jsxs)(l.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"text-center py-20 border border-slate-800/50",children:[(0,s.jsx)("div",{className:"text-teal font-mono text-sm tracking-widest mb-6",children:"AUDIT COMPLETE"}),(0,s.jsx)("h2",{className:"text-3xl font-light text-white mb-4",children:"Audit Certificate Generated"}),(0,s.jsx)("p",{className:"text-slate-400 font-light mb-12 max-w-md mx-auto",children:"Your audit certificate has been downloaded. All creditor data has been purged."}),(0,s.jsxs)("button",{onClick:ex,className:"inline-flex items-center gap-3 px-8 py-4 bg-teal text-midnight font-medium hover:bg-white transition-colors",children:["Analyze Another File",(0,s.jsx)(c.A,{className:"w-4 h-4"})]})]},"certificate")]})]})}),(0,s.jsx)(x.A,{})]})]})}},477:()=>{},877:(e,t,a)=>{Promise.resolve().then(a.bind(a,255))},1989:(e,t,a)=>{"use strict";a.d(t,{U:()=>i});var s=a(5417);function i(){let e="https://ovgreczzkybegjxcazqv.supabase.co",t="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im92Z3JlY3p6a3liZWdqeGNhenF2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU0ODI3NDMsImV4cCI6MjA4MTA1ODc0M30.uu9m-LZhXdIfOtPJmG21bVQQzLKFjL5V3EfbBZ4EnRI";return e&&t?(0,s.createBrowserClient)(e,t):(0,s.createBrowserClient)("https://placeholder.supabase.co","placeholder-key")}},2383:()=>{},3686:()=>{}},e=>{e.O(0,[524,297,258,417,590,745,441,255,358],()=>e(e.s=877)),_N_E=e.O()}]);